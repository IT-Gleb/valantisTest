import{u as m,r as i,s as E,T as k,E as w,l as y,I as _,a as R,n as N,_ as M,L as S,j as s,M as A,F as T}from"./index-Bwl6BUXv.js";async function D(l,n,r,d=0,x=1e3){let c=E(l),a=0;try{r(!0);const o=await fetch(k,c),p=await o.json();if(o.ok||(a=o.status,w(a)),o.ok){let f=Array.from(p.result);f=y.uniq(f),f.length>_&&(f=f.slice(d*_,d*_+R)),c=E({action:"get_items",params:{ids:f}});const h=await fetch(k,c),g=await h.json();h.ok||(a=h.status,w(a)),h.ok&&(n(g.result),r(!1))}}catch(o){console.log(o),a!==401&&a!==403&&a!==404&&setTimeout(()=>{D(l,n,r,d)},x),r(!1)}}async function F(l,n,r,d=1e3){const x=E(l);let c=-1;try{r(!0);const a=await fetch(k,x),o=await a.json();a.ok&&(n(o.result.length),r(!1)),a.ok||(n(-1),c=a.status,w(c))}catch(a){console.log(a),r(!1),c!==401&&c!==403&&c!==404&&setTimeout(()=>{F(l,n,r)},d)}}function C(){const l=m(e=>e.active),n=m(e=>e.filterMode),r=m(e=>e.filterBrand),d=m(e=>e.filterName),x=m(e=>e.filterPrice),c=m(e=>e.activePage),[a,o]=i.useState(0),[p,f]=i.useState(!1),[v,h]=i.useState(0),[g,j]=i.useState([]);return i.useEffect(()=>{let e={action:"filter"};switch(n){case 0:e.params={brand:r===N?null:r};break;case 1:e.params={product:d};break;case 2:e.params={price:x};break}function P(t){h(t),o(Math.ceil(t/_))}function b(t){f(t)}F(e,P,b)},[l]),i.useEffect(()=>{let e={action:"filter"};switch(n){case 0:e.params={brand:r===N?null:r};break;case 1:e.params={product:d};break;case 2:e.params={price:x};break}D(e,t=>{if(Array.isArray(t)){let u=Array.from(t);u.length>1&&(u=y.uniqBy(u,"id")),u.length>_&&(u=u.slice(0,_)),u=y.orderBy(u,["price"],["asc"]),j(u)}},t=>{f(t)},c)},[c]),{allRec:v,PagesCount:a,isLoad:p,data:g}}const L=i.lazy(()=>M(()=>import("./index-Bwl6BUXv.js").then(l=>l.v),__vite__mapDeps([0,1]))),I=i.lazy(()=>M(()=>import("./Pages-Br4cH03H.js"),__vite__mapDeps([2,0,1])));function V(){const{allRec:l,PagesCount:n,data:r,isLoad:d}=C(),x=m(t=>t.setActive),c=m(t=>t.setActivePage),[a,o]=i.useState(0),p=m(t=>t.filterMode),f=m(t=>t.currentValue),[v,h]=i.useState(""),[g,j]=i.useState(!0),e=i.useRef(-1),P=()=>{x(!1)},b=(t,u)=>{t.preventDefault(),c(u),o(u)};if(i.useEffect(()=>{let t="";switch(p){case 0:t="По бренду";break;case 1:t="По наименованию";break;case 2:t="По цене";break}h(t)},[p]),i.useEffect(()=>(j(!0),e.current=setTimeout(()=>{j(!1),d&&(j(!1),clearInterval(e.current),e.current=setTimeout(()=>{j(!0)},S))},S),()=>{clearTimeout(e.current)}),[a]),g)return s.jsx("div",{className:"w-[100%] mt-4",children:s.jsx(A,{})});if(!g&&r.length<1)return s.jsxs("section",{className:"w-[100%",children:[s.jsx("div",{className:"flex items-center justify-end p-2",children:s.jsx(T,{paramTitle:"Отменить фильтрацию",setShowFilter:P})}),s.jsx("div",{className:"w-fit mx-auto font-medium text-[1.8rem]/[2rem] mt-8",children:"По Вашему запросу - ничего не найдено... :-("})]});if(!g)return s.jsxs("section",{className:"w-[100%] p-0 m-0",children:[s.jsx("div",{className:"flex items-center justify-end p-2",children:s.jsx(T,{paramTitle:"Отменить фильтрацию",setShowFilter:P})}),s.jsxs("div",{className:"bg-slate-100 text-slate-500 p-4 text-[0.85rem]/[1rem] font-semibold flex flex-col gap-y-2",children:[s.jsxs("h3",{children:["Записи отфильтрованы="," ",s.jsx("span",{className:"text-blue-700 uppercase",children:v})]}),s.jsxs("h4",{children:["Значение="," ",s.jsx("span",{className:"text-[1.2rem]/[1.2rem] text-blue-600",children:f})]}),s.jsxs("h4",{children:["Всего найдено="," ",s.jsx("span",{className:"text-blue-600 text-[1.1rem]/[1.2rem] font-medium",children:l})," ","наименований"]})]}),s.jsx(i.Suspense,{fallback:s.jsx(A,{}),children:r.length>0&&l>0&&s.jsx(L,{paramItems:r,paramMaxRec:n,paramPage:a})}),s.jsx(i.Suspense,{fallback:s.jsx(A,{}),children:n>1&&s.jsx("div",{className:"w-[100%] border-t-2 border-t-slate-400/40 mt-4",children:s.jsx(I,{paramPageCount:n,paramCurrPage:a,paramChangePage:b})})})]})}export{V as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-Bwl6BUXv.js","assets/index-BmH299kc.css","assets/Pages-Br4cH03H.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
