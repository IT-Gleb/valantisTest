import{u as m,r as i,s as k,T as w,E as A,l as y,I as _,a as R,n as N,_ as M,L as S,j as a,M as E,F as T}from"./index-BLp04b6X.js";async function D(o,c,r,d=0,h=1e3){let n=k(o),s=0;try{r(!0);const u=await fetch(w,n),j=await u.json();if(u.ok||(s=u.status,A(s)),u.ok){let l=Array.from(j.result);l.length<1&&(s=133,A(s)),l=y.uniq(l),l.length>_&&(l=l.slice(d*_,d*_+R)),n=k({action:"get_items",params:{ids:l}});const x=await fetch(w,n),g=await x.json();x.ok||(s=x.status,A(s)),x.ok&&c(g.result)}}catch(u){console.log(u),s!==133&&s!==401&&s!==403&&s!==404&&setTimeout(()=>{D(o,c,r,d)},h),r(!1)}}async function F(o,c,r,d=1e3){const h=k(o);let n=-1;try{r(!0);const s=await fetch(w,h),u=await s.json();s.ok&&(c(u.result.length),r(!1)),s.ok||(c(-1),n=s.status,A(n))}catch(s){console.log(s),r(!1),n!==401&&n!==403&&n!==404&&setTimeout(()=>{F(o,c,r)},d)}}function C(){const o=m(e=>e.active),c=m(e=>e.filterMode),r=m(e=>e.filterBrand),d=m(e=>e.filterName),h=m(e=>e.filterPrice),n=m(e=>e.activePage),[s,u]=i.useState(0),[j,l]=i.useState(!1),[v,x]=i.useState(0),[g,p]=i.useState([]);return i.useEffect(()=>{let e={action:"filter"};switch(c){case 0:e.params={brand:r===N?null:r};break;case 1:e.params={product:d};break;case 2:e.params={price:h};break}function P(t){x(t),u(Math.ceil(t/_)),l(!1)}function b(t){l(t)}F(e,P,b)},[o]),i.useEffect(()=>{let e={action:"filter"};switch(c){case 0:e.params={brand:r===N?null:r};break;case 1:e.params={product:d};break;case 2:e.params={price:h};break}D(e,t=>{if(Array.isArray(t)){let f=Array.from(t);f.length>1&&(f=y.uniqBy(f,"id")),f.length>_&&(f=f.slice(0,_)),f=y.orderBy(f,["price"],["asc"]),p(f)}},t=>{l(t)},n)},[n]),{allRec:v,PagesCount:s,isLoad:j,data:g}}const L=i.lazy(()=>M(()=>import("./index-BLp04b6X.js").then(o=>o.v),__vite__mapDeps([0,1]))),I=i.lazy(()=>M(()=>import("./Pages-B1Irx7Va.js"),__vite__mapDeps([2,0,1])));function V(){const{allRec:o,PagesCount:c,data:r,isLoad:d}=C(),h=m(t=>t.setActive),n=m(t=>t.setActivePage),[s,u]=i.useState(0),j=m(t=>t.filterMode),l=m(t=>t.currentValue),[v,x]=i.useState(""),[g,p]=i.useState(!0),e=i.useRef(-1),P=()=>{h(!1)},b=(t,f)=>{t.preventDefault(),n(f),u(f)};if(i.useEffect(()=>{let t="";switch(j){case 0:t="По бренду";break;case 1:t="По наименованию";break;case 2:t="По цене";break}x(t)},[j]),i.useEffect(()=>(p(!0),e.current=setTimeout(()=>{d||r.length<1?(p(!0),clearInterval(e.current),e.current=setTimeout(()=>{d&&r.length<1?p(!0):p(!1)},S)):p(!1)},S),()=>{clearTimeout(e.current)}),[s]),g)return a.jsx("div",{className:"w-[100%] mt-[20%]",children:a.jsx(E,{})});if(!g&&r.length<1)return a.jsxs("section",{className:"w-[100%",children:[a.jsx("div",{className:"flex items-center justify-end p-2",children:a.jsx(T,{paramTitle:"Отменить фильтрацию",setShowFilter:P})}),a.jsx("div",{className:"w-fit mx-auto font-medium text-[1.8rem]/[2rem] mt-8",children:"По Вашему запросу - ничего не найдено... :-("})]});if(!g)return a.jsxs("section",{className:"w-[100%] p-0 m-0",children:[a.jsx("div",{className:"flex items-center justify-end p-2",children:a.jsx(T,{paramTitle:"Отменить фильтрацию",setShowFilter:P})}),a.jsxs("div",{className:"bg-slate-100 text-slate-500 p-4 text-[0.85rem]/[1rem] font-semibold flex flex-col gap-y-2",children:[a.jsxs("h3",{children:["Записи отфильтрованы="," ",a.jsx("span",{className:"text-blue-700 uppercase",children:v})]}),a.jsxs("h4",{children:["Значение="," ",a.jsx("span",{className:"text-[1.2rem]/[1.2rem] text-blue-600",children:l})]}),a.jsxs("h4",{children:["Всего найдено="," ",a.jsx("span",{className:"text-blue-600 text-[1.1rem]/[1.2rem] font-medium",children:o})," ","наименований"]})]}),a.jsx(i.Suspense,{fallback:a.jsx(E,{}),children:r.length>0&&o>0&&a.jsx(L,{paramItems:r,paramMaxRec:c,paramPage:s})}),a.jsx(i.Suspense,{fallback:a.jsx(E,{}),children:c>1&&a.jsx("div",{className:"w-[100%] border-t-2 border-t-slate-400/40 mt-4",children:a.jsx(I,{paramPageCount:c,paramCurrPage:s,paramChangePage:b})})})]})}export{V as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/index-BLp04b6X.js","assets/index-m16rAWph.css","assets/Pages-B1Irx7Va.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
